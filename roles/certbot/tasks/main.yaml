- name: Install certbot
  ansible.builtin.apt:
    pkg:
      - certbot
      - python3-certbot-dns-cloudflare
    state: present

- name: Configure certbot cloudflare credentials
  ansible.builtin.template:
    src: etc/letsencrypt/cloudflare.ini.j2
    dest: /etc/letsencrypt/cloudflare.ini
    mode: "0600"

- name: Configure certbot deploy hook
  ansible.builtin.copy:
    src: etc/letsencrypt/renewal-hooks/deploy/proxmox-proxy
    dest: /etc/letsencrypt/renewal-hooks/deploy/proxmox-proxy
    mode: "0755"
  when: certbot__deploy_hook_proxmox | bool
